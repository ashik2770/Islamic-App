<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#111827">
    <meta name="description" content="Islamic Life Admin Panel">
    <title>Islamic Life - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/favicon.ico">
</head>
<body class="bg-gray-900 text-white min-h-screen font-sans overflow-y-auto">
    <!-- Main Content -->
    <main class="p-6">
        <header class="flex items-center justify-between mb-6">
            <h1 class="text-3xl font-bold text-emerald-400">Admin Panel</h1>
            <div class="flex items-center space-x-4">
                <span id="admin-name" class="text-gray-400"></span>
                <button id="logout" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">Logout</button>
            </div>
        </header>

        <div class="space-y-10" id="content">
            <!-- Dashboard -->
            <section id="dashboard" class="space-y-6">
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold text-emerald-400 mb-4">Overview</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-gray-700 p-4 rounded-lg">
                            <p class="text-gray-400">Total Duas</p>
                            <p id="total-duas" class="text-2xl font-bold text-emerald-400">0</p>
                        </div>
                        <div class="bg-gray-700 p-4 rounded-lg">
                            <p class="text-gray-400">Total Notifications</p>
                            <p id="total-notifications" class="text-2xl font-bold text-emerald-400">0</p>
                        </div>
                        <div class="bg-gray-700 p-4 rounded-lg">
                            <p class="text-gray-400">Total Tips</p>
                            <p id="total-tips" class="text-2xl font-bold text-emerald-400">0</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Duas -->
            <section id="duas" class="space-y-6">
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold text-emerald-400 mb-4">Manage Duas</h2>
                    <form id="dua-form" class="space-y-4">
                        <input type="text" id="dua-title" placeholder="Dua Title" class="w-full bg-gray-700 p-2 rounded-lg border border-emerald-500">
                        <textarea id="dua-content" placeholder="Dua Content" class="w-full bg-gray-700 p-2 rounded-lg border border-emerald-500"></textarea>
                        <button type="submit" class="w-full bg-emerald-600 p-2 rounded-lg hover:bg-emerald-700">Add Dua</button>
                    </form>
                    <div id="dua-list" class="mt-6 space-y-4 max-h-[50vh] overflow-y-auto"></div>
                </div>
            </section>

            <!-- Prayer Times -->
            <section id="prayers" class="space-y-6">
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold text-emerald-400 mb-4">Manage Forbidden Prayer Times</h2>
                    <form id="prayer-form" class="space-y-4">
                        <select id="prayer-type" class="w-full bg-gray-700 p-2 rounded-lg border border-emerald-500">
                            <option value="dawn">Dawn</option>
                            <option value="noon">Noon</option>
                            <option value="evening">Evening</option>
                        </select>
                        <input type="time" id="prayer-start" class="w-full bg-gray-700 p-2 rounded-lg border border-emerald-500">
                        <input type="time" id="prayer-end" class="w-full bg-gray-700 p-2 rounded-lg border border-emerald-500">
                        <button type="submit" class="w-full bg-emerald-600 p-2 rounded-lg hover:bg-emerald-700">Update Time</button>
                    </form>
                    <div id="prayer-list" class="mt-6 space-y-4"></div>
                </div>
            </section>

            <!-- Notifications -->
            <section id="notifications" class="space-y-6">
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold text-emerald-400 mb-4">Manage Notifications</h2>
                    <form id="notification-form" class="space-y-4">
                        <input type="text" id="notification-message" placeholder="Notification Message" class="w-full bg-gray-700 p-2 rounded-lg border border-emerald-500">
                        <button type="submit" class="w-full bg-emerald-600 p-2 rounded-lg hover:bg-emerald-700">Send Notification</button>
                    </form>
                    <div id="notification-list" class="mt-6 space-y-4 max-h-[50vh] overflow-y-auto"></div>
                </div>
            </section>

            <!-- Holidays -->
            <section id="holidays" class="space-y-6">
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold text-emerald-400 mb-4">Manage Holidays</h2>
                    <form id="holiday-form" class="space-y-4">
                        <input type="text" id="holiday-name" placeholder="Holiday Name" class="w-full bg-gray-700 p-2 rounded-lg border border-emerald-500">
                        <input type="date" id="holiday-date" class="w-full bg-gray-700 p-2 rounded-lg border border-emerald-500">
                        <button type="submit" class="w-full bg-emerald-600 p-2 rounded-lg hover:bg-emerald-700">Add Holiday</button>
                    </form>
                    <div id="holiday-list" class="mt-6 space-y-4 max-h-[50vh] overflow-y-auto"></div>
                </div>
            </section>

            <!-- Festivals -->
            <section id="festivals" class="space-y-6">
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold text-emerald-400 mb-4">Manage Festivals</h2>
                    <form id="festival-form" class="space-y-4">
                        <input type="text" id="festival-name" placeholder="Festival Name" class="w-full bg-gray-700 p-2 rounded-lg border border-emerald-500">
                        <input type="date" id="festival-date" class="w-full bg-gray-700 p-2 rounded-lg border border-emerald-500">
                        <button type="submit" class="w-full bg-emerald-600 p-2 rounded-lg hover:bg-emerald-700">Add Festival</button>
                    </form>
                    <div id="festival-list" class="mt-6 space-y-4 max-h-[50vh] overflow-y-auto"></div>
                </div>
            </section>

            <!-- Tips -->
            <section id="tips" class="space-y-6">
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold text-emerald-400 mb-4">Manage Islamic Tips</h2>
                    <form id="tip-form" class="space-y-4">
                        <textarea id="tip-content" placeholder="Tip Content" class="w-full bg-gray-700 p-2 rounded-lg border border-emerald-500"></textarea>
                        <button type="submit" class="w-full bg-emerald-600 p-2 rounded-lg hover:bg-emerald-700">Add Tip</button>
                    </form>
                    <div id="tip-list" class="mt-6 space-y-4 max-h-[50vh] overflow-y-auto"></div>
                </div>
            </section>
        </div>
    </main>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 p-6 rounded-xl shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold text-emerald-400 mb-4">Admin Login</h2>
            <form id="login-form" class="space-y-4">
                <input type="email" id="admin-email" placeholder="Email" class="w-full bg-gray-700 p-2 rounded-lg border border-emerald-500">
                <input type="password" id="admin-password" placeholder="Password" class="w-full bg-gray-700 p-2 rounded-lg border border-emerald-500">
                <button type="submit" class="w-full bg-emerald-600 p-2 rounded-lg hover:bg-emerald-700">Login</button>
            </form>
            <p id="auth-error" class="text-red-500 mt-2 hidden">Invalid credentials</p>
        </div>
    </div>

    <style>
        .bg-gray-800 { background: linear-gradient(135deg, #1f2937 0%, #111827 100%); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.1), 0 4px 6px -2px rgba(16, 185, 129, 0.05); }
    </style>

    <!-- Firebase SDK v10 -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getDatabase, ref, onValue, set, push, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        // Firebase Configuration (Replace with your own)
        const firebaseConfig = {
            apiKey: "AIzaSyDrfoR60PDZP1Jo3rdq9hA3i6ZSFCBnFug",
            authDomain: "muslim-web-app.firebaseapp.com",
            databaseURL: "https://muslim-web-app-default-rtdb.firebaseio.com",
            projectId: "muslim-web-app",
            storageBucket: "muslim-web-app.firebasestorage.app",
            messagingSenderId: "575010521833",
            appId: "1:575010521833:web:7ad541405854bf51106678",
            measurementId: "G-MEYHG9F7E4"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // DOM Elements
        const authModal = document.getElementById("auth-modal");
        const loginForm = document.getElementById("login-form");
        const adminName = document.getElementById("admin-name");
        const logoutButton = document.getElementById("logout");

        // Authentication
        onAuthStateChanged(auth, (user) => {
            if (user) {
                authModal.classList.add("hidden");
                adminName.textContent = `Welcome, ${user.email}`;
                loadDashboard();
            } else {
                authModal.classList.remove("hidden");
            }
        });

        loginForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const email = document.getElementById("admin-email").value;
            const password = document.getElementById("admin-password").value;
            signInWithEmailAndPassword(auth, email, password)
                .catch((error) => {
                    document.getElementById("auth-error").classList.remove("hidden");
                    console.error("Login Error:", error.message);
                });
        });

        logoutButton.addEventListener("click", () => {
            signOut(auth).catch((error) => console.error("Logout Error:", error.message));
        });

        // Dashboard
        function loadDashboard() {
            onValue(ref(database, "duas"), (snapshot) => {
                document.getElementById("total-duas").textContent = snapshot.val() ? Object.keys(snapshot.val()).length : 0;
            }, (error) => console.error("Dashboard Duas Error:", error));

            onValue(ref(database, "notifications"), (snapshot) => {
                document.getElementById("total-notifications").textContent = snapshot.val() ? Object.keys(snapshot.val()).length : 0;
            }, (error) => console.error("Dashboard Notifications Error:", error));

            onValue(ref(database, "tips"), (snapshot) => {
                document.getElementById("total-tips").textContent = snapshot.val() ? Object.keys(snapshot.val()).length : 0;
            }, (error) => console.error("Dashboard Tips Error:", error));
        }

        // Duas Management
        document.getElementById("dua-form").addEventListener("submit", (e) => {
            e.preventDefault();
            const title = document.getElementById("dua-title").value;
            const content = document.getElementById("dua-content").value;
            const duaRef = push(ref(database, "duas"));
            set(duaRef, { title, content })
                .then(() => e.target.reset())
                .catch((error) => console.error("Dua Add Error:", error));
        });

        onValue(ref(database, "duas"), (snapshot) => {
            const duaList = document.getElementById("dua-list");
            duaList.innerHTML = "";
            const duas = snapshot.val();
            if (duas) {
                Object.entries(duas).forEach(([id, dua]) => {
                    const div = document.createElement("div");
                    div.className = "bg-gray-700 p-4 rounded-lg flex justify-between items-center";
                    div.innerHTML = `
                        <div>
                            <p class="text-emerald-400">${dua.title}</p>
                            <p class="text-gray-400">${dua.content}</p>
                        </div>
                        <button class="text-red-400 hover:text-red-600" data-id="${id}">Delete</button>
                    `;
                    div.querySelector("button").addEventListener("click", () => {
                        remove(ref(database, `duas/${id}`)).catch((error) => console.error("Dua Delete Error:", error));
                    });
                    duaList.appendChild(div);
                });
            }
        }, (error) => console.error("Duas Load Error:", error));

        // Prayer Times Management
        document.getElementById("prayer-form").addEventListener("submit", (e) => {
            e.preventDefault();
            const type = document.getElementById("prayer-type").value;
            const start = document.getElementById("prayer-start").value;
            const end = document.getElementById("prayer-end").value;
            set(ref(database, `forbidden_times/${type}`), { start, end })
                .then(() => e.target.reset())
                .catch((error) => console.error("Prayer Update Error:", error));
        });

        onValue(ref(database, "forbidden_times"), (snapshot) => {
            const prayerList = document.getElementById("prayer-list");
            prayerList.innerHTML = "";
            const times = snapshot.val();
            if (times) {
                Object.entries(times).forEach(([type, time]) => {
                    const div = document.createElement("div");
                    div.className = "bg-gray-700 p-4 rounded-lg";
                    div.innerHTML = `
                        <p class="text-emerald-400">${type.charAt(0).toUpperCase() + type.slice(1)}</p>
                        <p class="text-gray-400">${time.start} - ${time.end}</p>
                    `;
                    prayerList.appendChild(div);
                });
            }
        }, (error) => console.error("Prayer Times Load Error:", error));

        // Notifications Management
        document.getElementById("notification-form").addEventListener("submit", (e) => {
            e.preventDefault();
            const message = document.getElementById("notification-message").value;
            const notificationRef = push(ref(database, "notifications"));
            set(notificationRef, { message, timestamp: new Date().toISOString() })
                .then(() => e.target.reset())
                .catch((error) => console.error("Notification Add Error:", error));
        });

        onValue(ref(database, "notifications"), (snapshot) => {
            const notificationList = document.getElementById("notification-list");
            notificationList.innerHTML = "";
            const notifications = snapshot.val();
            if (notifications) {
                Object.entries(notifications).forEach(([id, notif]) => {
                    const div = document.createElement("div");
                    div.className = "bg-gray-700 p-4 rounded-lg flex justify-between items-center";
                    div.innerHTML = `
                        <div>
                            <p class="text-emerald-400">${notif.message}</p>
                            <p class="text-gray-400">${new Date(notif.timestamp).toLocaleString()}</p>
                        </div>
                        <button class="text-red-400 hover:text-red-600" data-id="${id}">Delete</button>
                    `;
                    div.querySelector("button").addEventListener("click", () => {
                        remove(ref(database, `notifications/${id}`)).catch((error) => console.error("Notification Delete Error:", error));
                    });
                    notificationList.appendChild(div);
                });
            }
        }, (error) => console.error("Notifications Load Error:", error));

        // Holidays Management
        document.getElementById("holiday-form").addEventListener("submit", (e) => {
            e.preventDefault();
            const name = document.getElementById("holiday-name").value;
            const date = document.getElementById("holiday-date").value;
            const holidayRef = push(ref(database, "holidays"));
            set(holidayRef, { name, date })
                .then(() => e.target.reset())
                .catch((error) => console.error("Holiday Add Error:", error));
        });

        onValue(ref(database, "holidays"), (snapshot) => {
            const holidayList = document.getElementById("holiday-list");
            holidayList.innerHTML = "";
            const holidays = snapshot.val();
            if (holidays) {
                Object.entries(holidays).forEach(([id, holiday]) => {
                    const div = document.createElement("div");
                    div.className = "bg-gray-700 p-4 rounded-lg flex justify-between items-center";
                    div.innerHTML = `
                        <div>
                            <p class="text-emerald-400">${holiday.name}</p>
                            <p class="text-gray-400">${holiday.date}</p>
                        </div>
                        <button class="text-red-400 hover:text-red-600" data-id="${id}">Delete</button>
                    `;
                    div.querySelector("button").addEventListener("click", () => {
                        remove(ref(database, `holidays/${id}`)).catch((error) => console.error("Holiday Delete Error:", error));
                    });
                    holidayList.appendChild(div);
                });
            }
        }, (error) => console.error("Holidays Load Error:", error));

        // Festivals Management
        document.getElementById("festival-form").addEventListener("submit", (e) => {
            e.preventDefault();
            const name = document.getElementById("festival-name").value;
            const date = document.getElementById("festival-date").value;
            const festivalRef = push(ref(database, "festivals"));
            set(festivalRef, { name, date })
                .then(() => e.target.reset())
                .catch((error) => console.error("Festival Add Error:", error));
        });

        onValue(ref(database, "festivals"), (snapshot) => {
            const festivalList = document.getElementById("festival-list");
            festivalList.innerHTML = "";
            const festivals = snapshot.val();
            if (festivals) {
                Object.entries(festivals).forEach(([id, festival]) => {
                    const div = document.createElement("div");
                    div.className = "bg-gray-700 p-4 rounded-lg flex justify-between items-center";
                    div.innerHTML = `
                        <div>
                            <p class="text-emerald-400">${festival.name}</p>
                            <p class="text-gray-400">${festival.date}</p>
                        </div>
                        <button class="text-red-400 hover:text-red-600" data-id="${id}">Delete</button>
                    `;
                    div.querySelector("button").addEventListener("click", () => {
                        remove(ref(database, `festivals/${id}`)).catch((error) => console.error("Festival Delete Error:", error));
                    });
                    festivalList.appendChild(div);
                });
            }
        }, (error) => console.error("Festivals Load Error:", error));

        // Tips Management
        document.getElementById("tip-form").addEventListener("submit", (e) => {
            e.preventDefault();
            const content = document.getElementById("tip-content").value;
            const tipRef = push(ref(database, "tips"));
            set(tipRef, { content })
                .then(() => e.target.reset())
                .catch((error) => console.error("Tip Add Error:", error));
        });

        onValue(ref(database, "tips"), (snapshot) => {
            const tipList = document.getElementById("tip-list");
            tipList.innerHTML = "";
            const tips = snapshot.val();
            if (tips) {
                Object.entries(tips).forEach(([id, tip]) => {
                    const div = document.createElement("div");
                    div.className = "bg-gray-700 p-4 rounded-lg flex justify-between items-center";
                    div.innerHTML = `
                        <p class="text-emerald-400">${tip.content}</p>
                        <button class="text-red-400 hover:text-red-600" data-id="${id}">Delete</button>
                    `;
                    div.querySelector("button").addEventListener("click", () => {
                        remove(ref(database, `tips/${id}`)).catch((error) => console.error("Tip Delete Error:", error));
                    });
                    tipList.appendChild(div);
                });
            }
        }, (error) => console.error("Tips Load Error:", error));
    </script>
</body>
</html>
